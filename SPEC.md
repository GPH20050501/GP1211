# 多市場回測系統規格文檔

## 一、市場選擇模組

### 1. 市場分類與展示
- 8大類市場(美股、臺股、期貨、加密貨幣、指數、外匯、利率、能源、貴金屬、農產品)

  - 交易所
  - 日均交易量
  - 代碼
  - 名稱
  - 流動性排名

### 2. 投資組合配置
- P10: 選擇流動性最高的5個類別,每類2個品種
- P20: 選擇流動性最高的5個類別,每類4個品種
- P30: 全部8個類別,每類3-4個品種
- P40: 全部8個類別,每類5個品種

## 二、回測結果展示

### 1. 頂部資訊區
- 策略名稱
- 使用的技術指標參數
- 交易市場列表
- 回測時間範圍
- 初始資金

### 2. 績效指標面板
基本指標:
- 淨收益
- 年化複合成長率
- 最大回撤
- 回報/風險比
- 資金單位
- 期望值E[R]
- 破產風險(%)

交易統計:
- 總交易次數
- 平均淨收益
- 每筆交易平均手續費與滑價
- 獲利比
- 獲利百分比
- 平均盈虧比

資金管理:
- MMGT策略固定百分比
- MMGT起始資本
- 每筆交易平均風險(%)
- 平均淨收益$/USD(M)
- 年均複合成長率

### 3. 圖表展示
- 淨值曲線圖
  - 左Y軸:淨值
  - 右Y軸:資金金額
  - 標記最大回撤區間
  - 支持hover顯示數據

### 4. 數據保存功能
- 保存回測結果(JSON格式)
- 包含所有績效指標
- 支持歷史記錄比較
- 可匯出報告

## 三、技術實現

### 1. 使用技術
- Python
- Streamlit (UI)
- Plotly (圖表)
- Pandas (數據處理)
- SQLite (數據存儲)

### 2. 檔案結構
```
project/
├── data/
│   ├── market_data.py    # 市場數據處理
│   └── data_storage.py   # 數據存儲相關
├── ui/
│   ├── app.py           # 主應用程式
│   └── charts.py        # 圖表相關
├── strategies/
│   └── strategy.py      # 策略實現
├── utils/
│   └── performance.py   # 績效計算
└── SPEC.md             # 本規格文檔
```

### 3. 開發順序建議
1. 市場數據模組
2. 策略實現
3. 績效計算
4. UI介面
5. 數據存儲
6. 圖表展示
7. 測試與優化 